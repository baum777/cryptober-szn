import{prefersReducedMotion}from"/utils/a11y.js";const CONFIG={coingecko:{url:"https://api.coingecko.com/api/v3/simple/price",params:"ids=bitcoin,ethereum,solana&vs_currencies=usd&include_24hr_change=true",refreshInterval:3e4,cacheKey:"cryptober_prices",cacheDuration:6e4},news:{mockEnabled:!0,refreshInterval:3e5},ui:{toastDuration:1800,animationDuration:220}};let state={prices:null,news:[],timers:new Map,observers:new Map};export function toast(e,t=CONFIG.ui.toastDuration){let r=document.getElementById("toast");r||(r=document.createElement("div"),r.id="toast",r.className="toast",r.setAttribute("role","status"),r.setAttribute("aria-live","polite"),document.body.appendChild(r)),r.textContent=e,r.classList.add("visible");const a=setTimeout(()=>{r.classList.remove("visible")},t);state.timers.has("toast")&&clearTimeout(state.timers.get("toast")),state.timers.set("toast",a)}async function fetchWithCache(e,t={}){const{cacheKey:r,cacheDuration:a,timeout:s=1e4}=t;if(r&&a){const e=localStorage.getItem(r);if(e)try{const{data:t,timestamp:r}=JSON.parse(e);if(Date.now()-r<a)return t}catch(e){console.warn("Cache parse error:",e)}}const o=new AbortController,n=setTimeout(()=>o.abort(),s);try{const s=await fetch(e,{...t,signal:o.signal});if(clearTimeout(n),!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const i=await s.json();if(r&&a)try{localStorage.setItem(r,JSON.stringify({data:i,timestamp:Date.now()}))}catch(e){console.warn("Cache storage error:",e)}return i}catch(e){if("AbortError"===e.name)throw new Error("Request timeout");throw e}}function formatPrice(e,t="USD"){return"number"!=typeof e||isNaN(e)?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:e<1?6:2}).format(e)}function formatChange(e){if("number"!=typeof e||isNaN(e))return"N/A";return`${e>=0?"+":""}${e.toFixed(2)}%`}function formatRelativeTime(e){const t=Date.now()-e,r=Math.floor(t/6e4),a=Math.floor(t/36e5),s=Math.floor(t/864e5);return r<1?"Just now":r<60?`${r}m ago`:a<24?`${a}h ago`:`${s}d ago`}export async function fetchCryptoPrices(){const e=`${CONFIG.coingecko.url}?${CONFIG.coingecko.params}`;try{const t=await fetchWithCache(e,{cacheKey:CONFIG.coingecko.cacheKey,cacheDuration:CONFIG.coingecko.cacheDuration,timeout:8e3});return state.prices=t,updatePricesUI(t),t}catch(e){return console.error("CoinGecko fetch error:",e),displayPricesError(e.message),null}}function updatePricesUI(e){const t=document.getElementById("crypto-prices");if(!t)return;const r=[{id:"bitcoin",name:"Bitcoin",symbol:"BTC"},{id:"ethereum",name:"Ethereum",symbol:"ETH"},{id:"solana",name:"Solana",symbol:"SOL"}].map(t=>{const r=e[t.id];if(!r)return"";const a=formatPrice(r.usd),s=r.usd_24h_change||0,o=formatChange(s),n=s>=0?"text-neon-green":"text-danger";return`\n      <article class="price-card card-glass">\n        <div class="price-card__header">\n          <h3 class="price-card__coin">${t.symbol}</h3>\n          <span class="price-card__name muted">${t.name}</span>\n        </div>\n        <div class="price-card__body">\n          <div class="price-card__price">${a}</div>\n          <div class="price-card__change ${n}" aria-label="${s>=0?"Increase":"Decrease"} of ${Math.abs(s).toFixed(2)} percent">\n            ${o}\n          </div>\n        </div>\n      </article>\n    `}).join("");t.innerHTML=r,t.setAttribute("aria-live","polite");const a=document.getElementById("prices-timestamp");if(a){const e=(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});a.textContent=`Updated: ${e}`}}function displayPricesError(e){const t=document.getElementById("crypto-prices");t&&(t.innerHTML=`\n    <div class="error-card card-glass">\n      <p class="muted">‚ö†Ô∏è Unable to load live prices</p>\n      <p class="tiny">${e}</p>\n    </div>\n  `)}function startPriceRefresh(){const e=setInterval(()=>{fetchCryptoPrices()},CONFIG.coingecko.refreshInterval);state.timers.set("priceRefresh",e)}const MOCK_NEWS=[{id:1,title:"Bitcoin Hits New All-Time High in October Rally",summary:"BTC surges past previous records as institutional adoption accelerates during Uptober momentum.",timestamp:Date.now()-36e5,category:"Bitcoin",url:"#"},{id:2,title:"Ethereum 2.0 Staking Reaches Historic Milestone",summary:"ETH staking pools exceed expectations as network transitions fully to proof-of-stake.",timestamp:Date.now()-72e5,category:"Ethereum",url:"#"},{id:3,title:"Solana DeFi Ecosystem Expands with New Protocols",summary:"SOL-based DeFi protocols see massive growth as developers flock to the fast, low-cost network.",timestamp:Date.now()-144e5,category:"Solana",url:"#"},{id:4,title:"Crypto October: Historical Analysis Shows 83% Green Rate",summary:"Data from 2013-2024 confirms October as the most bullish month for crypto markets.",timestamp:Date.now()-216e5,category:"Market",url:"#"},{id:5,title:"Meme Coin Season Returns with Pumpkin-Themed Tokens",summary:"Halloween-themed crypto tokens surge as community rallies around seasonal narratives.",timestamp:Date.now()-432e5,category:"Memes",url:"#"}];export async function fetchNews(){if(CONFIG.news.mockEnabled)return state.news=MOCK_NEWS,updateNewsUI(MOCK_NEWS),MOCK_NEWS;try{return[]}catch(e){return console.error("News fetch error:",e),[]}}function updateNewsUI(e){const t=document.getElementById("news-feed");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<p class="muted">No news available</p>');const r=e.map(e=>`\n    <article class="news-card card-glass">\n      <div class="news-card__header">\n        <span class="news-card__category chip">${e.category}</span>\n        <time class="news-card__time muted" datetime="${new Date(e.timestamp).toISOString()}">\n          ${formatRelativeTime(e.timestamp)}\n        </time>\n      </div>\n      <h3 class="news-card__title">\n        <a href="${e.url}" class="news-card__link" target="_blank" rel="noopener noreferrer">\n          ${e.title}\n        </a>\n      </h3>\n      <p class="news-card__summary muted">${e.summary}</p>\n    </article>\n  `).join("");t.innerHTML=r,t.setAttribute("aria-live","polite")}export function initClipboard(){document.querySelectorAll("[data-copy]").forEach(e=>{const t=e.getAttribute("data-copy");if(!t)return;e.style.cursor="pointer",e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-label",`Copy ${t.substring(0,20)}...`);const r=async()=>{try{await navigator.clipboard.writeText(t),toast("Copied! ‚úÖ"),navigator.vibrate&&navigator.vibrate(50)}catch(e){console.error("Copy failed:",e),toast("Copy failed - please copy manually")}};e.addEventListener("click",r),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())})})}export function initScrollSpy(){const e=document.querySelectorAll("[data-target]");if(0===e.length)return{destroy:()=>{}};const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&e.forEach(e=>{const r=e.getAttribute("href");(r?r.substring(1):"")===t.target.id?(e.setAttribute("aria-current","true"),e.classList.add("is-active")):(e.removeAttribute("aria-current"),e.classList.remove("is-active"))})})},{rootMargin:"-20% 0% -70% 0%",threshold:[0,.5,1]});return e.forEach(e=>{const r=e.getAttribute("href"),a=r?r.substring(1):"",s=document.getElementById(a);s&&t.observe(s)}),state.observers.set("scrollSpy",t),{destroy:()=>{t.disconnect(),state.observers.delete("scrollSpy")}}}export function initMobileNav(){const e=document.querySelector(".site-header__toggle"),t=document.querySelector(".left-rail"),r=document.createElement("div");if(r.className="mobile-overlay",r.setAttribute("aria-hidden","true"),!e||!t)return{destroy:()=>{}};document.body.appendChild(r);const a=()=>{t.classList.remove("is-open"),r.classList.remove("is-visible"),document.body.classList.remove("offcanvas-open"),e.setAttribute("aria-expanded","false"),r.setAttribute("aria-hidden","true")};e.addEventListener("click",()=>{t.classList.contains("is-open")?a():(t.classList.add("is-open"),r.classList.add("is-visible"),document.body.classList.add("offcanvas-open"),e.setAttribute("aria-expanded","true"),r.setAttribute("aria-hidden","false"))}),r.addEventListener("click",a);return t.querySelectorAll("a").forEach(e=>{e.addEventListener("click",a)}),{destroy:()=>{r.remove()}}}export function setFooterYear(){const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear())}export function initLazyLoading(){if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.dataset.src&&(e.src=e.dataset.src)})}else{const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const r=e.target;r.src=r.dataset.src,r.removeAttribute("data-src"),t.unobserve(r)}})},{rootMargin:"50px"});e.forEach(e=>t.observe(e)),state.observers.set("lazyLoad",t)}}export function init(){console.log("üöÄ Cryptober App Initialized"),setFooterYear(),initClipboard(),initScrollSpy(),initMobileNav(),initLazyLoading(),fetchCryptoPrices(),fetchNews(),startPriceRefresh(),prefersReducedMotion()&&document.body.classList.add("reduced-motion")}export function destroy(){state.timers.forEach(e=>clearTimeout(e)),state.timers.clear(),state.observers.forEach(e=>e.disconnect()),state.observers.clear(),state={prices:null,news:[],timers:new Map,observers:new Map},console.log("üßπ Cryptober App Cleaned Up")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init(),window.addEventListener("beforeunload",destroy);export default{init:init,destroy:destroy,fetchCryptoPrices:fetchCryptoPrices,fetchNews:fetchNews,toast:toast};
//# sourceMappingURL=app.min.js.map